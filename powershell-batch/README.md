# BackupOldWinContextMenuRegistry

## 簡介

`BackupOldWinContextMenuRegistry_v0.5.ps1` 是一個用於備份舊 Windows 系統右鍵選單（Context Menu）相關註冊表的 PowerShell 腳本，特別適用於 Windows 10 系統的註冊表維護與資料擷取。本工具可自動掛載外部 Windows 系統磁碟的 SOFTWARE hive，批次導出多種右鍵選單的註冊表鍵值，最終產生易於分析的 CSV 檔案，方便後續清理、比對與遷移等需求。

## 主要功能

- 自動偵測及掛載指定來源磁碟之 SOFTWARE hive。
- 支援多種常見 Context Menu 相關註冊表路徑一次性批次導出。
- 產出包含註冊表路徑、鍵值名稱、預設值的 CSV 檔。
- 具備錯誤日誌紀錄與自動管理暫存掛載。
- 介面全中文化，並有詳細操作提示。

## 運行環境需求

- Windows 10 或以上版本。
- PowerShell 5.1 或更新版本（建議以系統管理員權限執行）。
- 建議有基礎的系統維護知識。
- 必須先於本機建立 Code Signing 憑證（腳本內含詳細說明）。

**註：非英語系統環境下，下載腳本後請用文書編輯工具將本腳本轉碼為ANSI格式，避免執行時出現亂碼。(或將內容用翻譯工具轉成英文)**

## 使用方式

1. **準備來源磁碟：** 將目標 Windows 系統磁碟以 USB、SATA 等方式外接至本機。
2. **以系統管理員權限開啟 PowerShell。**
3. **執行腳本：**
   ```powershell
   powershell -ExecutionPolicy Bypass -File .\BackupOldWinContextMenuRegistry_v0.5.ps1
   ```
4. **依介面提示輸入來源磁碟（如 E:\）與匯出 CSV 保存路徑（如 D:\Backup\）**
5. **完成後於目標資料夾取得 ContextMenuHandlers-OldSOFTWARE.csv 及錯誤日誌（如有）。**

### 參數說明

- `-h` 顯示幫助說明
- `-SourceDisk <來源磁碟根目錄>`（如 E:\）
- `-Target <CSV 匯出資料夾>`（如 D:\Backup\）

## 執行結果截圖

下圖為腳本成功執行並產生 CSV 檔案的顯示畫面截圖：

![程序運行完成說明截圖](/batch-dev/powershell-batch/pic/v0.5_success.png)

---

## 開發過程難點與版本改進重點

### v0.2 → v0.3

- **主要改進：**
  - 改善參數輸入方式，加入互動式提示，減少操作錯誤機率。
  - 增加權限自檢，無管理員權限自動升權，提升使用便利性。
  - 開始支援多路徑搜尋多種 Context Menu 註冊表項，擴增備份覆蓋範圍。
- **開發難點：**
  - 如何在無破壞性前提下掛載外部 hive，確保不影響來源系統安全。
  - 參數處理與權限管理需兼顧通用性與安全性。

### v0.3 → v0.5

- **主要改進：**
  - 引入錯誤日誌機制，所有過程異常皆完整記錄於檔案，提升後續追蹤與維護效率。
  - 強化多語系與編碼支援，預設輸出與日誌皆為 UTF-8，避免亂碼。
  - 所有關鍵步驟皆給予明確提示，進度條顯示多筆處理狀況。
  - 完善掛載與釋放流程，防止資源遺留及 hive 鎖定問題。
  - 細緻化命令行參數處理，支援全自動與半自動兩種執行模式。
- **開發難點：**
  - 確保 hive 掛載/卸載流程的穩定性，避免批次操作下遺留暫存映像。
  - 不同語系 Windows 下路徑、權限、編碼等細節兼容性測試。

---

## 改用其他高效程式語言的建議

- **PowerShell 優點：**
  - 深度整合 Windows API 與註冊表操作，權限管理與系統命令調度便利。
  - 較低學習門檻，易於維護與擴充。
- **潛在替代方案：**
  - **C#/.NET**：可做成 GUI 工具，支援多執行緒處理及更強異常管理，建議進階擴充時採用。
  - **Python（加 winreg/pywin32）**：跨平台性佳，適合需與其他自動化流程整合，但對於 Windows hive 批次掛載、權限與語系支援需額外處理。
  - **Rust/Go**：高效穩定，但 Windows 系統內部操作相關生態資源較少，適合對效能極致要求或需打包單一可執行檔時考慮。
- **建議方向：**
  - 若後續需整合大量批次、圖形化、網路傳輸等新功能，建議可考慮以 C# 開發桌面應用程式，以提升用戶體驗與可維護性。
  - 若主要維持批次自動化與維運腳本，PowerShell 仍為最佳選擇。

---

## 聯絡與發展

- 作者：FanG198202
- 聯絡信箱：fan198202@gmail.com

歡迎任何反饋與建議！
